<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Histogrammes — Dé & Sommes de dés</title>
  <meta name="theme-color" content="#60a5fa" />
  <style>
    :root{
      --bg:#0b1020; --fg:#e5e7eb; --muted:#a3b1c6;
      --accent:#60a5fa; --panel:#141a2f; --border:#263046;
      --bar:#1e3a8a; --grid:#334155;
    }
    html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.55 system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:1200px;margin:0 auto;padding:1rem 1.2rem 2rem}

    .topbar{display:flex;gap:.6rem;align-items:center;margin-bottom:.5rem}
    a.back, a.back:visited{color:#fff;text-decoration:none}
    a.back:hover, a.back:focus-visible{color:#e5e7eb;outline:2px solid #e5e7eb;outline-offset:2px}

    /* Onglets */
    .tabs{
      display:flex;
      gap:.8rem;
      margin-bottom:1.2rem;
    }
    .tab-btn{
      padding:.6rem 1.6rem;
      background:var(--panel);
      color:var(--accent);
      border:2px solid var(--accent);
      border-radius:.6rem .6rem 0 0;
      font-weight:900;
      font-size:1rem;
      cursor:pointer;
      user-select:none;
      transition:.12s;
      outline:none;
    }
    .tab-btn.active, .tab-btn:active, .tab-btn:focus{
      background:var(--accent);
      color:#0b1020;
      border-bottom:2px solid var(--bg);
      position:relative;
      z-index:2;
    }

    .tab-contents > .tab-panel { display:none; }
    .tab-contents > .tab-panel.active { display:block; }

    .panel{background:var(--panel);border:1px solid var(--border);border-radius:.8rem;padding:1rem}
    .chart-wrap{padding:0}
    .chart-svg{width:100%;height:auto;display:block}
    .chart-grid{stroke:var(--grid);stroke-width:1;opacity:.4}
    .bar-rect{fill:var(--bar);opacity:.88}
    .chart-text{fill:#cbd5e1;font:600 13px/1 system-ui,Segoe UI,Roboto}
    .axis-label{fill:#cbd5e1;font-weight:800}
    .hint{color:var(--muted);text-align:center;margin:.5rem 0 0}

    /* Couche des boutons alignée pixel-par-pixel sous le graphe */
    .buttons-layer{
      position:relative;
      margin-top:1rem;
    }
    .round-btn{
      position:absolute; top:0;
      width:66px;height:66px;border-radius:9999px;
      background:transparent;border:2px solid var(--accent);
      color:var(--accent);font-weight:900;font-size:18px;
      display:flex;align-items:center;justify-content:center;
      text-align:center;cursor:pointer;user-select:none;
      transition:.12s ease;
    }
    .round-btn:hover{background:var(--accent);color:#0b1020;transform:translateY(-1px)}
    .round-btn:active{transform:translateY(0)}

    .controls{display:flex;justify-content:center;gap:.6rem;margin-top:1rem}
    .ctl-btn{
      padding:.6rem 1rem;border-radius:.55rem;border:2px solid var(--accent);
      background:transparent;color:var(--accent);font-weight:900;cursor:pointer;user-select:none;
      transition:.12s ease;
    }
    .ctl-btn:hover{background:var(--accent);color:#0b1020;transform:translateY(-1px)}
    .ctl-btn:active{transform:translateY(0)}

    @media (max-width:680px){
      .round-btn{width:58px;height:58px;font-size:17px}
    }
    @media (max-width:520px){
      .round-btn{width:52px;height:52px;font-size:16px}
    }
    @media (prefers-reduced-motion: reduce){
      *{transition:none !important;scroll-behavior:auto !important}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Haut gauche: retour index -->
    <div class="topbar">
      <a class="back" href="index.html">← Retour à l’index</a>
    </div>

    <!-- Onglets -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="tab1">Dé (1 à 6)</button>
      <button class="tab-btn" data-tab="tab2">Sommes de 2 dés (2 à 12)</button>
    </div>

    <!-- Contenus des onglets -->
    <div class="tab-contents">
      <!-- Histogramme Dé 1..6 -->
      <section id="tab1" class="tab-panel active">
        <section class="panel chart-wrap">
          <svg id="chart1" class="chart-svg" viewBox="0 0 1000 520" role="img" aria-label="Histogramme des résultats du dé (1..6)"></svg>
          <p id="hint1" class="hint">Cliquez sur un bouton 1 à 6 pour incrémenter la barre correspondante.</p>
        </section>
        <div id="btns1" class="buttons-layer" role="group" aria-label="Ajouter une occurrence (résultat du dé 1 à 6)"></div>
        <div id="ctrls1" class="controls">
          <button id="resetBtn1" class="ctl-btn" type="button">Reset</button>
        </div>
      </section>

      <!-- Histogramme Sommes 2..12 -->
      <section id="tab2" class="tab-panel">
        <section class="panel chart-wrap">
          <svg id="chart2" class="chart-svg" viewBox="0 0 1000 520" role="img" aria-label="Histogramme des sommes de 2 dés (2..12)"></svg>
          <p id="hint2" class="hint">Cliquez sur un bouton 2 à 12 pour incrémenter la barre correspondante.</p>
        </section>
        <div id="btns2" class="buttons-layer" role="group" aria-label="Ajouter une occurrence (somme de deux dés 2 à 12)"></div>
        <div id="ctrls2" class="controls">
          <button id="resetBtn2" class="ctl-btn" type="button">Reset</button>
        </div>
      </section>
    </div>
  </div>

  <script>
  // GESTION DES ONGLETS
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', function(){
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(btn.dataset.tab).classList.add('active');
      // Appel du resize pour bien aligner les boutons si resize ou changement d'onglet
      setTimeout(()=>{
        if(btn.dataset.tab=="tab1"){
          positionButtons1();
          syncResetToChart1({viewW:1000,marginL:70,marginR:30});
        }else{
          positionButtons2();
          syncResetToChart2({viewW:1000,marginL:70,marginR:30});
        }
      },10);
    });
  });

  // --------- HISTOGRAMME 1: Dé (1 à 6) ---------
  // Utils
  const $1 = (s, ctx=document)=>ctx.querySelector(s);
  const store1 = {
    get(k, f=null){ try{ return JSON.parse(localStorage.getItem(k)) ?? f; } catch { return f; } },
    set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
  };
  const K1 = { bins: 'hist:dice:counts:v2' };

  const FACES = [1,2,3,4,5,6];
  const N1 = FACES.length;

  function getCounts1(){
    const a = store1.get(K1.bins, null);
    return Array.isArray(a) && a.length===N1 ? a : new Array(N1).fill(0);
  }
  function setCounts1(arr){ store1.set(K1.bins, arr); renderChart1(); positionButtons1(); }

  function el1(name, attrs={}){
    const e = document.createElementNS('http://www.w3.org/2000/svg', name);
    for (const k in attrs){ e.setAttribute(k, attrs[k]); }
    return e;
  }

  const chart1 = $1('#chart1');
  const hint1 = $1('#hint1');

  function renderChart1(){
    const counts = getCounts1();
    chart1.innerHTML = '';
    const m = { l:70, r:30, t:24, b:36 };
    const W = 1000, H = 520;
    const PW = W - m.l - m.r, PH = H - m.t - m.b;
    chart1.appendChild(el1('rect', { x:m.l, y:m.t, width:PW, height:PH, fill:'none', stroke:'rgba(148,163,184,.32)' }));
    const total = counts.reduce((s,v)=>s+v,0);
    hint1.textContent = total===0
      ? 'Cliquez sur un bouton 1 à 6 pour incrémenter la barre correspondante.'
      : '';
    const maxC = Math.max(1, ...counts);
    const yTicks = Math.max(5, Math.ceil(maxC/3));
    for (let i=0;i<=yTicks;i++){
      const frac = i / yTicks;
      const gy = m.t + PH - frac * PH;
      chart1.appendChild(el1('line',{x1:m.l,y1:gy,x2:m.l+PW,y2:gy,class:'chart-grid'}));
      const lbl = el1('text',{x:m.l-10, y:gy+4, class:'chart-text', 'text-anchor':'end'});
      lbl.textContent = Math.round(frac * maxC);
      chart1.appendChild(lbl);
    }

    const stepW = PW / N1;
    const barW = stepW * 0.70;
    const scaleY = c => (c/maxC) * (PH * 0.92);

    for (let i=0;i<N1;i++){
      const c = counts[i];
      const bh = scaleY(c);
      const bx = m.l + i*stepW + (stepW - barW)/2;
      const by = m.t + PH - bh;

      chart1.appendChild(el1('rect', {
        x:bx, y:by, width:barW, height:bh, class:'bar-rect'
      }));

      if (c > 0){
        chart1.appendChild(el1('text', {
          x:bx + barW/2, y:by - 6, 'text-anchor':'middle', fill:'#93c5fd', style:'font-weight:800'
        })).textContent = c;
      }
    }
    // Axe Y
    const yl = el1('text',{x:22,y:m.t+PH/2,class:'axis-label','text-anchor':'middle',
      transform:`rotate(-90 22 ${m.t+PH/2})`});
    yl.textContent = 'Comptes';
    chart1.appendChild(yl);

    positionButtons1();
    syncResetToChart1({ viewW: W, marginL: m.l, marginR: m.r });
  }

  const btns1 = $1('#btns1');
  function buildButtons1(){
    btns1.innerHTML = '';
    FACES.forEach((v, i)=>{
      const btn = document.createElement('button');
      btn.className = 'round-btn';
      btn.type = 'button';
      btn.textContent = String(v);
      btn.setAttribute('data-index', i);
      btn.setAttribute('aria-label', `Ajouter ${v}`);
      btn.addEventListener('click', ()=>{
        const arr = getCounts1();
        arr[i] = (arr[i]||0) + 1;
        setCounts1(arr);
      });
      btns1.appendChild(btn);
    });
    positionButtons1();
  }

  function positionButtons1(){
    const rect = chart1.getBoundingClientRect();
    const svgWidthPx = rect.width;
    const viewW = 1000, marginL = 70, marginR = 30;
    const leftPx = svgWidthPx * (marginL / viewW);
    const rightPx = svgWidthPx * (marginR / viewW);
    const plotW = svgWidthPx - leftPx - rightPx;

    btns1.style.width = svgWidthPx + 'px';
    btns1.style.marginLeft = 'auto';
    btns1.style.marginRight = 'auto';
    btns1.style.paddingLeft = '0';
    btns1.style.paddingRight = '0';

    const buttons = Array.from(btns1.children);
    if (buttons.length === 0) return;

    let maxH = 0;
    for (const b of buttons) maxH = Math.max(maxH, b.getBoundingClientRect().height);
    btns1.style.height = Math.ceil(maxH) + 'px';

    const stepWpx = plotW / N1;
    buttons.forEach((b, i)=>{
      const bw = b.getBoundingClientRect().width;
      const centerX = leftPx + (i + 0.5) * stepWpx;
      const left = centerX - bw / 2;
      b.style.left = left + 'px';
    });
  }

  const ctrls1 = $1('#ctrls1');
  const resetBtn1 = $1('#resetBtn1');
  resetBtn1.addEventListener('click', ()=>{
    if (!confirm('Effacer tous les comptes ?')) return;
    setCounts1(new Array(N1).fill(0));
  });

  function syncResetToChart1({ viewW, marginL, marginR }){
    const rect = chart1.getBoundingClientRect();
    const svgWidthPx = rect.width;
    const leftPx = svgWidthPx * (marginL / viewW);
    const rightPx = svgWidthPx * (marginR / viewW);

    ctrls1.style.width = svgWidthPx + 'px';
    ctrls1.style.marginLeft = 'auto';
    ctrls1.style.marginRight = 'auto';
    ctrls1.style.paddingLeft = leftPx + 'px';
    ctrls1.style.paddingRight = rightPx + 'px';
  }

  // Init 1
  buildButtons1();
  renderChart1();

  // --------- HISTOGRAMME 2: Sommes 2..12 ---------
  // Utils
  const $2 = (s, ctx=document)=>ctx.querySelector(s);
  const store2 = {
    get(k, f=null){ try{ return JSON.parse(localStorage.getItem(k)) ?? f; } catch { return f; } },
    set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
  };
  const K2 = { bins: 'hist:dice2:counts:v2' };

  const SUMS = Array.from({length:11}, (_,i)=>i+2);
  const N2 = SUMS.length;

  function getCounts2(){
    const a = store2.get(K2.bins, null);
    return Array.isArray(a) && a.length===N2 ? a : new Array(N2).fill(0);
  }
  function setCounts2(arr){ store2.set(K2.bins, arr); renderChart2(); positionButtons2(); }

  function el2(name, attrs={}){
    const e = document.createElementNS('http://www.w3.org/2000/svg', name);
    for (const k in attrs){ e.setAttribute(k, attrs[k]); }
    return e;
  }

  const chart2 = $2('#chart2');
  const hint2 = $2('#hint2');

  function renderChart2(){
    const counts = getCounts2();
    chart2.innerHTML = '';
    const m = { l:70, r:30, t:24, b:36 };
    const W = 1000, H = 520;
    const PW = W - m.l - m.r, PH = H - m.t - m.b;
    chart2.appendChild(el2('rect', { x:m.l, y:m.t, width:PW, height:PH, fill:'none', stroke:'rgba(148,163,184,.32)' }));
    const total = counts.reduce((s,v)=>s+v,0);
    hint2.textContent = total===0
      ? 'Cliquez sur un bouton 2 à 12 pour incrémenter la barre correspondante.'
      : '';
    const maxC = Math.max(1, ...counts);
    const yTicks = Math.max(5, Math.ceil(maxC/3));
    for (let i=0;i<=yTicks;i++){
      const frac = i / yTicks;
      const gy = m.t + PH - frac * PH;
      chart2.appendChild(el2('line',{x1:m.l,y1:gy,x2:m.l+PW,y2:gy,class:'chart-grid'}));
      const lbl = el2('text',{x:m.l-10, y:gy+4, class:'chart-text', 'text-anchor':'end'});
      lbl.textContent = Math.round(frac * maxC);
      chart2.appendChild(lbl);
    }

    const stepW = PW / N2;
    const barW = stepW * 0.70;
    const scaleY = c => (c/maxC) * (PH * 0.92);

    for (let i=0;i<N2;i++){
      const c = counts[i];
      const bh = scaleY(c);
      const bx = m.l + i*stepW + (stepW - barW)/2;
      const by = m.t + PH - bh;

      chart2.appendChild(el2('rect', {
        x:bx, y:by, width:barW, height:bh, class:'bar-rect'
      }));

      if (c > 0){
        chart2.appendChild(el2('text', {
          x:bx + barW/2, y:by - 6, 'text-anchor':'middle', fill:'#93c5fd', style:'font-weight:800'
        })).textContent = c;
      }
    }
    // Axe Y
    const yl = el2('text',{x:22,y:m.t+PH/2,class:'axis-label','text-anchor':'middle',
      transform:`rotate(-90 22 ${m.t+PH/2})`});
    yl.textContent = 'Comptes';
    chart2.appendChild(yl);

    positionButtons2();
    syncResetToChart2({ viewW: W, marginL: m.l, marginR: m.r });
  }

  const btns2 = $2('#btns2');
  function buildButtons2(){
    btns2.innerHTML = '';
    SUMS.forEach((v, i)=>{
      const btn = document.createElement('button');
      btn.className = 'round-btn';
      btn.type = 'button';
      btn.textContent = String(v);
      btn.setAttribute('data-index', i);
      btn.setAttribute('aria-label', `Ajouter ${v}`);
      btn.addEventListener('click', ()=>{
        const arr = getCounts2();
        arr[i] = (arr[i]||0) + 1;
        setCounts2(arr);
      });
      btns2.appendChild(btn);
    });
    positionButtons2();
  }

  function positionButtons2(){
    const rect = chart2.getBoundingClientRect();
    const svgWidthPx = rect.width;
    const viewW = 1000, marginL = 70, marginR = 30;
    const leftPx = svgWidthPx * (marginL / viewW);
    const rightPx = svgWidthPx * (marginR / viewW);
    const plotW = svgWidthPx - leftPx - rightPx;

    btns2.style.width = svgWidthPx + 'px';
    btns2.style.marginLeft = 'auto';
    btns2.style.marginRight = 'auto';
    btns2.style.paddingLeft = '0';
    btns2.style.paddingRight = '0';

    const buttons = Array.from(btns2.children);
    if (buttons.length === 0) return;

    let maxH = 0;
    for (const b of buttons) maxH = Math.max(maxH, b.getBoundingClientRect().height);
    btns2.style.height = Math.ceil(maxH) + 'px';

    const stepWpx = plotW / N2;
    buttons.forEach((b, i)=>{
      const bw = b.getBoundingClientRect().width;
      const centerX = leftPx + (i + 0.5) * stepWpx;
      const left = centerX - bw / 2;
      b.style.left = left + 'px';
    });
  }

  const ctrls2 = $2('#ctrls2');
  const resetBtn2 = $2('#resetBtn2');
  resetBtn2.addEventListener('click', ()=>{
    if (!confirm('Effacer tous les comptes ?')) return;
    setCounts2(new Array(N2).fill(0));
  });

  function syncResetToChart2({ viewW, marginL, marginR }){
    const rect = chart2.getBoundingClientRect();
    const svgWidthPx = rect.width;
    const leftPx = svgWidthPx * (marginL / viewW);
    const rightPx = svgWidthPx * (marginR / viewW);

    ctrls2.style.width = svgWidthPx + 'px';
    ctrls2.style.marginLeft = 'auto';
    ctrls2.style.marginRight = 'auto';
    ctrls2.style.paddingLeft = leftPx + 'px';
    ctrls2.style.paddingRight = rightPx + 'px';
  }

  // Init 2
  buildButtons2();
  renderChart2();

  // Resize: actualiser l'alignement selon l'onglet actif
  window.addEventListener('resize', ()=>{
    if(document.querySelector('.tab-btn.active').dataset.tab=="tab1"){
      positionButtons1();
      syncResetToChart1({viewW:1000,marginL:70,marginR:30});
    }else{
      positionButtons2();
      syncResetToChart2({viewW:1000,marginL:70,marginR:30});
    }
  });
  </script>
</body>
</html>
